<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gateway.Bookmarks</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="./css/larkRoot.css">
<link rel="stylesheet" href="./css/contextMenu.css">



</head>
<body>
    <style>
        .flexBox_h{
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content:flex-start;
        }

        .leftPanel{
            width:20% ;
            height:100vh ;
            flex-grow: 0;
            overflow-x: hidden;
            overflow-y: hidden;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }

        .rightPanel{
            width:80% ;
            height:100% ;
            flex-grow: 1;
            overflow-x: hidden;
            overflow-y: auto;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items:flex-start;
        }

        .larkSelected{
            background-color: black;
            color: azure;
        }
    </style>
    <div class="larkRoot flexBox_h">
        <div class="leftPanel">
            <style>
                /*
                .headerToolBar{
                    width:100% ;
                    height:20px ;
                    flex-grow: 0 ;
                    background-color:blue;
                }
                */
                .headerToolBar{
                    width:100% ;
                    height:1.5rem ;
                    flex-grow: 0 ;
                    /*background-color:chocolate;*/

                    display: flex;
                    flex-direction: row;
                    justify-content: space-between;
                    align-items: center;

                    font-size: 1.2em;
                    padding-left: 10px;
                    padding-right: 10px;

                }
                .folderBrowser{
                    width:100% ;
                    flex-grow: 1;
                    background-color: rgb(243, 232, 232);
                    overflow-x: hidden;
                    overflow-y: hidden;
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    align-items: center;

                    padding-left: 10px;
                    padding-right: 10px;
                }
                .bottomToolBar{
                    width:100% ;
                    height:2rem ;
                    flex-grow: 0 ;
                    /*background-color: brown;*/
                    font-size: 1.2em;

                    display: flex;
                    flex-direction: row;
                    justify-content:center;
                    align-items:center;
                    align-content: center;

                }

                .larkBTN{
                    font-size: 24px;
                }

                .larkBTN:hover{
                    cursor: pointer;
                }
            </style>
            <div class="headerToolBar">
                <div>
                    <i class="bi-person-circle larkBTN" id="idBTNPersonal"></i>
                    <span>alexszhang@gmail.com</span>
                </div>
                <div>
                    <i class="bi-plus larkBTN" id="idBTNPlusFolder"></i>
                </div>
            </div>
            <div class="folderBrowser">
                <style>
                    .mustHave{
                        background-color:aqua;
                        width:100% ;
                        height:200px;
                        flex-grow: 0;
                        overflow-y: hidden;
                        overflow-x: hidden;
                    }
                    .Folders{
                        background-color:rgb(209, 207, 217);
                        width:100% ;
                        flex-grow: 0;
                        overflow-y: auto;
                        overflow-x: hidden;
                    }

                    .bookmark:hover{
                        cursor:pointer ;
                    }

                    .Folders details{
                        width:100% ;
                    }

                    .folder:hover{
                        cursor:pointer ;
                    }

                    details > summary {
                        list-style: none;
                    }
                    details > summary::-webkit-details-marker {
                        display: none;
                    }

                    details ul{
                        padding-left: 5px;
                    }
                </style>
                <div class="mustHave"></div>
                <div class="Folders"></div>
            </div>
            <div class="bottomToolBar">
                <i class="bi-gear-wide-connected larkBTN" id="idBTNSetting"></i>
            </div>
        </div>
        <div class="rightPanel">
            <style>
                
                .mainCanvas{
                    width:100% ;
                    flex-grow: 1 ;
                    background-color:bisque;
                }

                .mainFootBar{
                    width:100% ;
                    height:2rem ;
                    flex-grow: 0 ;
                    background-color: cadetblue;
                    font-size: 1.2em;
                }
            </style>
            <div class="headerToolBar">
                <div>
                    <i class="bi-list larkBTN" id="idBTNToggleLeftPannel"></i>
                </div>
                <div>
                    <i class="bi-plus larkBTN" id="idBTNPlusContent"></i>
                </div>
            </div>
            <div class="mainCanvas">
                <h2>main canvas</h2>
                <div class="container">
                    <h1 style="text-align: center;padding: 12px;">自定义右键菜单，请右键查看菜单效果</h1>
                     <!-- 填充内容 -->
                </div>
            </div>
            <div class="mainFootBar">footbar</div>
        </div>
    </div>
    
    <script src="./js/larkContextMenu.js"></script>
    <script src="./js/ContextMenuData.js"></script>
    <script src="./js/jsonGateway.js"></script>
    <script>
        const contextMenus = new ContextMenus({
            className: '.container', 
            menu:jsonMenu
        }) ;
        console.log(contextMenus);
        contextMenus.on((item, evt) => {
            console.log(item, evt);
        }) ;
    </script>

    <script>
        document.querySelector('#idBTNToggleLeftPannel').addEventListener('click',(event)=>{
            let tagLeftPanel = document.querySelector('.leftPanel') ;
            //tagLeftPanel.classList.toggle('noShow') ;
            if(tagLeftPanel.classList.contains('noShow')){
                tagLeftPanel.classList.remove('noShow') ;
            }else{
                tagLeftPanel.classList.add('noShow') ;
            }
        }) ;

        document.querySelector('#idBTNPlusFolder').addEventListener('click',(event)=>{
            alert('idBTNPlusFolder TBD') ;
        }) ;

        document.querySelector('#idBTNPersonal').addEventListener('click',(event)=>{
            alert('idBTNPersonal TBD') ;
        }) ;

        document.querySelector('#idBTNSetting').addEventListener('click',(event)=>{
            alert('idBTNSetting TBD') ;
        }) ;
        
        document.querySelector('#idBTNPlusContent').addEventListener('click',(event)=>{
            alert('idBTNPlusContent TBD') ;
        }) ;

        function gwRenderBookmark(jsonBookmark,tagParent){
            let tagBookMark = document.createElement('li') ;
            tagBookMark.innerHTML=`
                <i class="bi-journal-bookmark-fill"></i>
                ${jsonBookmark.title}
            ` ;
            tagParent.appendChild(tagBookMark) ;
            tagBookMark.classList.add('bookmark') ;

            tagBookMark.classList.add('larkDraggable') ;
            tagBookMark.setAttribute('draggable', true);

            //bookmark
            tagBookMark.dataset.url = jsonBookmark.url ;
            tagBookMark.addEventListener('click',(event)=>{
                let tagBookMark = event.target.closest('li') ;
                let url = tagBookMark.dataset.url ;
                let tagCurSelected = document.querySelector('.larkSelected') ;
                if(tagCurSelected!=null){
                    if(tagCurSelected!= tagBookMark){
                        tagCurSelected.classList.remove('larkSelected') ;
                    }
                }
                tagBookMark.classList.add('larkSelected') ;
                if(tagCurSelected!=tagBookMark){
                    window.open(url, '_blank').focus();
                }
            }) ;
        }

        function gwRenderFolder(jsonFolder,tagParent){
            let tagBookFolder = document.createElement('details') ;
            tagBookFolder.innerHTML=`
                    <style>
                        .folderSummary{
                            display: flex;
                            flex-direction: row;
                            justify-content: space-between;
                        }
                        .folderSummary:hover{
                            background-color:bisque;
                        }

                        .folderSummary #idBTNMore{
                            visibility: hidden;
                        }
                        .folderSummary:hover #idBTNMore{
                            visibility: visible;
                        }

                        .folderSummary #idFolderCounter{
                            visibility: visible;
                            font-size:0.65em ;
                        }
                        .folderSummary:hover #idFolderCounter{
                            visibility: hidden;
                        }

                    </style>
                    <summary class="folderSummary">
                        <span>
                            <i class="bi-folder2-open"></i>
                            ${jsonFolder.title}
                        </span>
                        <div>
                            <span id="idFolderCounter">32</span>
                            <i class="bi-three-dots" id="idBTNMore"></i>   
                        </div>                
                    </summary>
                    <ul></ul>
            ` ;
            tagParent.appendChild(tagBookFolder) ;
            tagBookFolder.classList.add('folder') ;
            tagBookFolder.querySelector('ul').classList.add('larkDroppable');


            tagBookFolder.addEventListener('click',(event)=>{

                let tagBookFolder = event.target.closest('details') ;
                let tagCurSelected = document.querySelector('.larkSelected') ;
                if(tagCurSelected!=null){
                    if(tagCurSelected!= tagBookFolder){
                        tagCurSelected.classList.remove('larkSelected') ;
                    }
                }
                tagBookFolder.classList.add('larkSelected') ;


            }) ;

            tagBookFolder.querySelector('#idBTNMore').addEventListener('click',(event)=>{
                event.preventDefault() ;
                alert('TBD') ;
            }) ;

            for(let i=0;i<jsonFolder.Contents.length;i++){
                if(jsonFolder.Contents[i].type == 'Gateway.Folder'){
                    gwRenderFolder(jsonFolder.Contents[i],tagBookFolder.querySelector('ul')) ;
                }else{
                    gwRenderBookmark(jsonFolder.Contents[i],tagBookFolder.querySelector('ul'))
                }
            }
        }

        function gwRenderDesktop(jsonGateway,cssRootElement){
            let tagRoot=document.querySelector(cssRootElement) ;
            let tagMustHave = tagRoot.querySelector('.mustHave') ;
            let tagFolders = tagRoot.querySelector('.Folders') ;

            tagMustHave.innerHTML = `
                <ul></ul>
            ` ;

            let tagMustHaveUL = tagMustHave.querySelector('ul') ;
            for(let i=0;i<jsonGateway.data.mustHave.length;i++){
                gwRenderBookmark(jsonGateway.data.mustHave[i],tagMustHaveUL) ;
            }

            tagFolders.innerHTML = `
                <ul></ul>
            ` ;
            let tagFoldersUL = tagFolders.querySelector('ul') ;
            for(i=0;i<jsonGateway.data.Folders.length;i++){
                if(jsonGateway.data.Folders[i].type == "Gateway.Folder"){
                    gwRenderFolder(jsonGateway.data.Folders[i],tagFoldersUL) ;
                }else{
                    gwRenderBookmark(jsonGateway.data.Folders[i],tagFoldersUL) ;
                }
            }
        }

        gwRenderDesktop(jsonGateway,'.folderBrowser') ;
    </script>
    <script>
        let globalDraggedItem = null;

        enbaleDragNDrop('.larkDraggable') ;

        function enbaleDragNDrop(cssContainer){
            // Select the list and all list items
            const items = document.querySelectorAll(cssContainer);

            for(let i=0;i<items.length;i++){
                let item = items[i] ;
                item.addEventListener('dragstart', function(event) {
                    globalDraggedItem = event.target;
                    setTimeout(() => {
                        event.target.style.display = 'none';
                    }, 0);
                });

                // When dragging over other items
                item.addEventListener('dragover', function(e) {
                    e.preventDefault(); // Prevent default to allow drop
                });

                // When the dragging enters a new list item
                item.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    item.style.borderTop = '2px solid #3498db';
                });

                // When dragging leaves a list item
                item.addEventListener('dragleave', function() {
                    item.style.borderTop = '';
                });

                // When the item is dropped
                item.addEventListener('drop', function(event) {
                    //let ddItem = event.target ;
                    event.target.style.borderTop = '';
                    if(globalDraggedItem==null){
                        console.log('null globalDraggedItem');
                        return ;
                    }
                    if (globalDraggedItem !== this) {
                        //list.insertBefore(globalDraggedItem, this);
                        let parentNode = event.target.parentNode ;
                        if(parentNode.classList.contains('larkDroppable')){
                            parentNode.insertBefore(globalDraggedItem, this);
                            //globalDraggedItem.style.display = 'block';
                            //globalDraggedItem = null ;
                        }
                        
                    }
                });

                // When the drag ends
                item.addEventListener('dragend', function() {
                    setTimeout(() => {
                        globalDraggedItem.style.display = 'block';
                        globalDraggedItem = null;
                    }, 0);
                });
            }
        }
    </script>
</body>
</html>