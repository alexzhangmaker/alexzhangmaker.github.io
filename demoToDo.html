<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ€Todoåº”ç”¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen transition-colors duration-300">
    <div class="container mx-auto px-4 py-8">
        <!-- å¤´éƒ¨ -->
        <header class="mb-8 fade-in">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white">åŠ¨æ€Todoæ¸…å•</h1>
                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300">
                    <span id="currentPath"></span>
                    <button id="settingsBtn" class="ml-2 px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        é…ç½®
                    </button>
                </div>
            </div>
            
            <!-- æœç´¢å’Œè¿‡æ»¤ -->
            <div class="flex flex-wrap gap-4 mt-4">
                <input type="text" id="searchInput" placeholder="æœç´¢todo..." 
                       class="flex-1 min-w-[200px] px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                
                <select id="tagFilter" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="">æ‰€æœ‰æ ‡ç­¾</option>
                </select>
                
                <select id="statusFilter" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="active">æ´»åŠ¨çŠ¶æ€</option>
                    <option value="archived">å·²å½’æ¡£</option>
                    <option value="all">å…¨éƒ¨çŠ¶æ€</option>
                </select>
                
                <button id="addTodoBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                    æ–°å»ºTodo
                </button>
            </div>
        </header>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div id="stats" class="mb-6 grid grid-cols-2 md:grid-cols-4 gap-4 fade-in">
            <!-- ç»Ÿè®¡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- Todoåˆ—è¡¨å®¹å™¨ -->
        <div id="todoList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Todoå¡ç‰‡å°†åŠ¨æ€æ¸²æŸ“åœ¨è¿™é‡Œ -->
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div id="emptyState" class="hidden text-center py-12 fade-in">
            <div class="text-gray-400 dark:text-gray-500 mb-4">
                <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-600 dark:text-gray-400 mb-2">æš‚æ— å¾…åŠäº‹é¡¹</h3>
            <p class="text-gray-500 dark:text-gray-500 mb-4">ç‚¹å‡»"æ–°å»ºTodo"å¼€å§‹æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡</p>
            <button id="emptyAddBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                åˆ›å»ºç¬¬ä¸€ä¸ªTodo
            </button>
        </div>
    </div>

    <!-- ç¼–è¾‘/æ–°å»ºTodoçš„å¯¹è¯æ¡† -->
    <div id="todoDialog" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4 fade-in">
            <h2 id="dialogTitle" class="text-xl font-bold mb-4 text-gray-800 dark:text-white">æ–°å»ºTodo</h2>
            <form id="todoForm" class="space-y-4">
                <input type="hidden" id="todoId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">æ ‡é¢˜ *</label>
                    <input type="text" id="title" required
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">æ ‡ç­¾ (é€—å·åˆ†éš”)</label>
                    <input type="text" id="tags"
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                           placeholder="å·¥ä½œ, ç´§æ€¥, ä¸ªäºº">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">å¼€å§‹æ—¥æœŸ *</label>
                        <input type="date" id="startDate" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ç»“æŸæ—¥æœŸ *</label>
                        <input type="date" id="endDate" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ä¼˜å…ˆçº§</label>
                    <select id="priority" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="low">ä½</option>
                        <option value="medium">ä¸­</option>
                        <option value="high">é«˜</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">è´Ÿè´£äºº *</label>
                    <input type="text" id="assignee" required
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                </div>
                
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" id="cancelBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md transition-colors">
                        ä¿å­˜
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- é…ç½®å¯¹è¯æ¡† -->
    <div id="settingsDialog" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 fade-in">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">åº”ç”¨é…ç½®</h2>
            <div class="space-y-6 max-h-96 overflow-y-auto">
                <!-- è·¯å¾„é…ç½® -->
                <div>
                    <h3 class="text-lg font-medium mb-3 text-gray-800 dark:text-white">æ•°æ®è·¯å¾„é…ç½®</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Todoæ•°æ®æ ¹è·¯å¾„</label>
                            <input type="text" id="appRootPath" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Firebaseæ•°æ®åº“ä¸­çš„è·¯å¾„ï¼Œä¾‹å¦‚: /todos æˆ– /users/123/todos</p>
                        </div>
                    </div>
                </div>

                <!-- åŠŸèƒ½å¼€å…³ -->
                <div>
                    <h3 class="text-lg font-medium mb-3 text-gray-800 dark:text-white">åŠŸèƒ½å¼€å…³</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="featureSearch" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">æœç´¢åŠŸèƒ½</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="featureFiltering" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">æ ‡ç­¾è¿‡æ»¤</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="featureArchiving" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">å½’æ¡£åŠŸèƒ½</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="featureDueDateWarning" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">åˆ°æœŸæé†’</span>
                        </label>
                    </div>
                </div>

                <!-- UIé…ç½® -->
                <div>
                    <h3 class="text-lg font-medium mb-3 text-gray-800 dark:text-white">ç•Œé¢è®¾ç½®</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ä¸»é¢˜</label>
                            <select id="uiTheme" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="light">æµ…è‰²</option>
                                <option value="dark">æ·±è‰²</option>
                                <option value="auto">è‡ªåŠ¨</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">æ¯è¡Œå¡ç‰‡æ•°é‡</label>
                            <select id="uiCardsPerRow" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="1">1ä¸ª</option>
                                <option value="2">2ä¸ª</option>
                                <option value="3">3ä¸ª</option>
                                <option value="4">4ä¸ª</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between items-center pt-6 mt-6 border-t border-gray-200 dark:border-gray-600">
                <button type="button" id="resetSettingsBtn" class="px-4 py-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 transition-colors">
                    é‡ç½®ä¸ºé»˜è®¤
                </button>
                <div class="flex gap-3">
                    <button type="button" id="settingsCancelBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
                        å–æ¶ˆ
                    </button>
                    <button type="button" id="saveSettingsBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md transition-colors">
                        ä¿å­˜é…ç½®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>

        // Firebaseé…ç½® - è¯·æ›¿æ¢ä¸ºä½ çš„å®é™…é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyA6MZ_p5lVuy8TMAqiuV6IRx9fggV44lQs",
            authDomain: "outpost-8d74e.firebaseapp.com",
            databaseURL: "https://outpost-8d74e.asia-southeast1.firebasedatabase.app/",
            projectId: "outpost-8d74e",
            storageBucket: "outpost-8d74e.firebasestorage.app",
            messagingSenderId: "724993324937",
            appId: "1:724993324937:web:ce6c7e6b06489331c79358",
            measurementId: "G-QPHWRTH6BH"
        };

// åˆå§‹åŒ–Firebase
try {
    firebase.initializeApp(firebaseConfig);
    console.log('Firebaseåˆå§‹åŒ–æˆåŠŸ');
} catch (error) {
    console.error('Firebaseåˆå§‹åŒ–å¤±è´¥:', error);
}

const database = firebase.database();

// Firebaseå·¥å…·å‡½æ•°
const FirebaseService = {
    // è·å–æŒ‡å®šè·¯å¾„çš„todos
    async getTodos(path = '/todos') {
        try {
            const snapshot = await database.ref(path).once('value');
            const data = snapshot.val() || {};
            console.log(`ä»è·¯å¾„ ${path} è·å–åˆ° ${Object.keys(data).length} ä¸ªtodos`);
            return data;
        } catch (error) {
            console.error(`è·å–todoså¤±è´¥ (è·¯å¾„: ${path}):`, error);
            return {};
        }
    },

    // æ·»åŠ æˆ–æ›´æ–°todo
    async saveTodo(todoId, todoData, path = '/todos') {
        try {
            await database.ref(`${path}/${todoId}`).set(todoData);
            console.log(`Todoä¿å­˜æˆåŠŸ: ${todoId} (è·¯å¾„: ${path})`);
            return true;
        } catch (error) {
            console.error(`ä¿å­˜todoå¤±è´¥ (è·¯å¾„: ${path}):`, error);
            return false;
        }
    },

    // åˆ é™¤todo
    async deleteTodo(todoId, path = '/todos') {
        try {
            await database.ref(`${path}/${todoId}`).remove();
            console.log(`Todoåˆ é™¤æˆåŠŸ: ${todoId} (è·¯å¾„: ${path})`);
            return true;
        } catch (error) {
            console.error(`åˆ é™¤todoå¤±è´¥ (è·¯å¾„: ${path}):`, error);
            return false;
        }
    },

    // ç›‘å¬todoså˜åŒ–
    onTodosChange(callback, path = '/todos') {
        database.ref(path).on('value', (snapshot) => {
            const data = snapshot.val() || {};
            callback(data);
        });
        console.log(`å¼€å§‹ç›‘å¬todoså˜åŒ– (è·¯å¾„: ${path})`);
    },

    // åœæ­¢ç›‘å¬todoså˜åŒ–
    offTodosChange(path = '/todos') {
        database.ref(path).off('value');
        console.log(`åœæ­¢ç›‘å¬todoså˜åŒ– (è·¯å¾„: ${path})`);
    },

    // è·å–åº”ç”¨é…ç½®æ•°æ®
    async getAppSettings(path = '/appSetting/todoSetting') {
        try {
            const snapshot = await database.ref(path).once('value');
            const settings = snapshot.val();
            
            if (!settings) {
                console.warn('æœªæ‰¾åˆ°åº”ç”¨é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
                return this.getDefaultSettings();
            }
            
            console.log('æˆåŠŸè·å–åº”ç”¨é…ç½®:', settings);
            return settings;
        } catch (error) {
            console.error('è·å–åº”ç”¨é…ç½®å¤±è´¥:', error);
            console.warn('ä½¿ç”¨é»˜è®¤é…ç½®ç»§ç»­è¿è¡Œ');
            return this.getDefaultSettings();
        }
    },

    // ç›‘å¬åº”ç”¨é…ç½®å˜åŒ–
    onAppSettingsChange(callback, path = '/appSetting/todoSetting') {
        database.ref(path).on('value', (snapshot) => {
            const settings = snapshot.val();
            const finalSettings = settings || this.getDefaultSettings();
            callback(finalSettings);
        });
        console.log(`å¼€å§‹ç›‘å¬åº”ç”¨é…ç½®å˜åŒ– (è·¯å¾„: ${path})`);
    },

    // åœæ­¢ç›‘å¬åº”ç”¨é…ç½®å˜åŒ–
    offAppSettingsChange(path = '/appSetting/todoSetting') {
        database.ref(path).off('value');
        console.log(`åœæ­¢ç›‘å¬åº”ç”¨é…ç½®å˜åŒ– (è·¯å¾„: ${path})`);
    },

    // ä¿å­˜åº”ç”¨é…ç½®
    async saveAppSettings(settings, path = '/appSetting/todoSetting') {
        try {
            await database.ref(path).set(settings);
            console.log('åº”ç”¨é…ç½®ä¿å­˜æˆåŠŸ:', settings);
            return true;
        } catch (error) {
            console.error('ä¿å­˜åº”ç”¨é…ç½®å¤±è´¥:', error);
            return false;
        }
    },

    // é»˜è®¤é…ç½®
    getDefaultSettings() {
        return {
            appRootPath: '/todos',
            features: {
                search: true,
                filtering: true,
                archiving: true,
                dueDateWarning: true
            },
            ui: {
                theme: 'light',
                cardsPerRow: 3,
                showAssignee: true,
                showTags: true
            },
            notifications: {
                enabled: true,
                remindBeforeDays: 1
            }
        };
    },

    // æµ‹è¯•æ•°æ®åº“è¿æ¥
    async testConnection() {
        try {
            await database.ref('.info/connected').once('value');
            console.log('Firebaseæ•°æ®åº“è¿æ¥æ­£å¸¸');
            return true;
        } catch (error) {
            console.error('Firebaseæ•°æ®åº“è¿æ¥å¤±è´¥:', error);
            return false;
        }
    }
};
    </script>
    <script>
        // Todoå·¥å…·å‡½æ•°
class TodoManager {
    constructor() {
        this.todos = {};
        this.currentFilter = '';
        this.currentSearch = '';
    }

    // ç”Ÿæˆå”¯ä¸€ID (YYYYMMDD-UUIDæ ¼å¼)
    generateTodoId() {
        const now = new Date();
        const dateStr = now.toISOString().slice(0,10).replace(/-/g, '');
        const uuid = 'xxxx-xxxx-4xxx-yxxx-xxxx'.replace(/[xy]/g, function(c) {
            const r = Math.random() * 16 | 0;
            const v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        return `${dateStr}-${uuid}`;
    }

    // åˆ›å»ºæ–°çš„todoå¯¹è±¡
    createTodo(data) {
        const now = new Date().toISOString();
        return {
            id: data.id || this.generateTodoId(),
            title: data.title || '',
            tags: Array.isArray(data.tags) ? data.tags : (data.tags || '').split(',').map(tag => tag.trim()).filter(tag => tag),
            startDate: data.startDate || now.split('T')[0],
            endDate: data.endDate || data.startDate || now.split('T')[0],
            priority: data.priority || 'medium',
            assignee: data.assignee || '',
            completed: data.completed || false,
            status: data.status || 'active',
            createdAt: data.createdAt || now,
            updatedAt: now
        };
    }

    // æ¸²æŸ“å•ä¸ªtodoå¡ç‰‡
    renderTodoCard(todo) {
        const priorityColors = {
            low: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
            medium: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
            high: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
        };

        const statusColors = {
            active: 'border-l-blue-500',
            archived: 'border-l-gray-400',
            deleted: 'border-l-red-300'
        };

        const statusIcons = {
            active: 'ğŸ”µ',
            archived: 'âšª',
            deleted: 'ğŸ”´'
        };

        const isOverdue = new Date(todo.endDate) < new Date() && !todo.completed && todo.status === 'active';
        const isToday = todo.endDate === new Date().toISOString().split('T')[0] && !todo.completed;
        
        return `
            <div class="bg-white dark:bg-gray-700 rounded-lg shadow-md p-4 border-l-4 ${
                statusColors[todo.status] || 'border-l-blue-500'
            } ${todo.status !== 'active' ? 'opacity-75' : ''} fade-in hover:shadow-lg transition-shadow">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex-1">
                        <h3 class="font-semibold text-lg ${
                            todo.completed ? 'line-through text-gray-500 dark:text-gray-400' : 'text-gray-800 dark:text-white'
                        }">
                            ${statusIcons[todo.status] || ''} ${this.escapeHtml(todo.title)}
                        </h3>
                        ${isOverdue ? `
                            <p class="text-xs text-red-500 dark:text-red-400 mt-1">âš ï¸ å·²è¿‡æœŸ</p>
                        ` : isToday ? `
                            <p class="text-xs text-orange-500 dark:text-orange-400 mt-1">ğŸ“… ä»Šå¤©åˆ°æœŸ</p>
                        ` : ''}
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColors[todo.priority]}">
                            ${this.getPriorityText(todo.priority)}
                        </span>
                        <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-600 dark:text-gray-300">
                            ${this.getStatusText(todo.status)}
                        </span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-1">
                        <span class="font-medium">è´Ÿè´£äºº:</span> ${this.escapeHtml(todo.assignee)}
                    </p>
                    <p class="text-sm text-gray-600 dark:text-gray-300">
                        <span class="font-medium">æ—¥æœŸ:</span> ${todo.startDate} ${todo.startDate !== todo.endDate ? `- ${todo.endDate}` : ''}
                    </p>
                </div>
                
                ${todo.tags && todo.tags.length > 0 ? `
                    <div class="mb-3 flex flex-wrap gap-1">
                        ${todo.tags.map(tag => `
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 text-xs rounded-full">
                                ${this.escapeHtml(tag)}
                            </span>
                        `).join('')}
                    </div>
                ` : ''}
                
                <div class="flex justify-between items-center pt-2 border-t border-gray-200 dark:border-gray-600">
                    <div class="flex gap-2">
                        ${todo.status === 'active' ? `
                            <button onclick="app.editTodo('${todo.id}')" 
                                    class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded transition-colors">
                                ç¼–è¾‘
                            </button>
                            <button onclick="app.archiveTodo('${todo.id}')" 
                                    class="px-3 py-1 bg-yellow-500 hover:bg-yellow-600 text-white text-sm rounded transition-colors">
                                å½’æ¡£
                            </button>
                        ` : ''}
                        
                        ${todo.status === 'archived' ? `
                            <button onclick="app.restoreTodo('${todo.id}')" 
                                    class="px-3 py-1 bg-green-500 hover:bg-green-600 text-white text-sm rounded transition-colors">
                                æ¢å¤
                            </button>
                        ` : ''}
                        
                        <button onclick="app.softDeleteTodo('${todo.id}')" 
                                class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm rounded transition-colors">
                            ${todo.status === 'deleted' ? 'å½»åº•åˆ é™¤' : 'åˆ é™¤'}
                        </button>
                    </div>
                    
                    ${todo.status === 'active' ? `
                        <button onclick="app.toggleComplete('${todo.id}')" 
                                class="px-3 py-1 ${
                                    todo.completed ? 'bg-gray-500 hover:bg-gray-600' : 'bg-green-500 hover:bg-green-600'
                                } text-white text-sm rounded transition-colors">
                            ${todo.completed ? 'æœªå®Œæˆ' : 'å®Œæˆ'}
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
    }

    // æ¸²æŸ“æ‰€æœ‰todos
    renderTodos(todos) {
        this.todos = todos;
        const filteredTodos = this.filterTodos(todos);
        const todoList = document.getElementById('todoList');
        const emptyState = document.getElementById('emptyState');
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        this.updateStats(todos, filteredTodos);
        
        if (Object.keys(filteredTodos).length === 0) {
            todoList.classList.add('hidden');
            emptyState.classList.remove('hidden');
        } else {
            todoList.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            todoList.innerHTML = Object.values(filteredTodos)
                .sort((a, b) => new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt))
                .map(todo => this.renderTodoCard(todo))
                .join('');
        }
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStats(allTodos, filteredTodos) {
        const stats = document.getElementById('stats');
        const total = Object.keys(allTodos).length;
        const active = Object.values(allTodos).filter(todo => todo.status === 'active').length;
        const completed = Object.values(allTodos).filter(todo => todo.completed && todo.status === 'active').length;
        const archived = Object.values(allTodos).filter(todo => todo.status === 'archived').length;
        const displayed = Object.keys(filteredTodos).length;

        stats.innerHTML = `
            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">${total}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">æ€»è®¡</div>
            </div>
            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                <div class="text-2xl font-bold text-green-600 dark:text-green-400">${active}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">æ´»è·ƒ</div>
            </div>
            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">${completed}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">å·²å®Œæˆ</div>
            </div>
            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                <div class="text-2xl font-bold text-gray-600 dark:text-gray-400">${displayed}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">æ˜¾ç¤ºä¸­</div>
            </div>
        `;
    }

    // è¿‡æ»¤todos
    filterTodos(todos) {
        const statusFilter = document.getElementById('statusFilter').value;
        
        let filtered = { ...todos };
        
        // çŠ¶æ€è¿‡æ»¤
        if (statusFilter && statusFilter !== 'all') {
            filtered = Object.fromEntries(
                Object.entries(filtered).filter(([id, todo]) => 
                    todo.status === statusFilter
                )
            );
        } else if (statusFilter === 'all') {
            // æ˜¾ç¤ºæ‰€æœ‰çŠ¶æ€ï¼ˆé™¤äº†å½»åº•åˆ é™¤çš„ï¼‰
            filtered = Object.fromEntries(
                Object.entries(filtered).filter(([id, todo]) => 
                    todo.status !== 'permanently_deleted'
                )
            );
        } else {
            // é»˜è®¤åªæ˜¾ç¤ºæ´»åŠ¨çŠ¶æ€
            filtered = Object.fromEntries(
                Object.entries(filtered).filter(([id, todo]) => 
                    todo.status === 'active'
                )
            );
        }
        
        // æœç´¢è¿‡æ»¤
        if (this.currentSearch) {
            const searchLower = this.currentSearch.toLowerCase();
            filtered = Object.fromEntries(
                Object.entries(filtered).filter(([id, todo]) => 
                    todo.title.toLowerCase().includes(searchLower) ||
                    todo.assignee.toLowerCase().includes(searchLower) ||
                    (todo.tags && todo.tags.some(tag => tag.toLowerCase().includes(searchLower)))
                )
            );
        }
        
        // æ ‡ç­¾è¿‡æ»¤
        if (this.currentFilter) {
            filtered = Object.fromEntries(
                Object.entries(filtered).filter(([id, todo]) => 
                    todo.tags && todo.tags.includes(this.currentFilter)
                )
            );
        }
        
        return filtered;
    }

    // æ›´æ–°æ ‡ç­¾è¿‡æ»¤å™¨é€‰é¡¹
    updateTagFilter(todos) {
        const tagFilter = document.getElementById('tagFilter');
        const allTags = new Set();
        
        Object.values(todos).forEach(todo => {
            if (todo.tags) {
                todo.tags.forEach(tag => allTags.add(tag));
            }
        });
        
        // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"æ‰€æœ‰æ ‡ç­¾"ï¼‰
        while (tagFilter.children.length > 1) {
            tagFilter.removeChild(tagFilter.lastChild);
        }
        
        // æ·»åŠ æ ‡ç­¾é€‰é¡¹
        Array.from(allTags).sort().forEach(tag => {
            const option = document.createElement('option');
            option.value = tag;
            option.textContent = tag;
            tagFilter.appendChild(option);
        });
    }

    // å·¥å…·å‡½æ•°
    escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    getPriorityText(priority) {
        const texts = { low: 'ä½', medium: 'ä¸­', high: 'é«˜' };
        return texts[priority] || priority;
    }

    getStatusText(status) {
        const statusTexts = {
            active: 'æ´»åŠ¨',
            archived: 'å·²å½’æ¡£',
            deleted: 'å·²åˆ é™¤'
        };
        return statusTexts[status] || status;
    }

    // è·å–todoç»Ÿè®¡ä¿¡æ¯
    getTodoStats(todos) {
        const allTodos = Object.values(todos);
        return {
            total: allTodos.length,
            active: allTodos.filter(todo => todo.status === 'active').length,
            completed: allTodos.filter(todo => todo.completed && todo.status === 'active').length,
            archived: allTodos.filter(todo => todo.status === 'archived').length,
            deleted: allTodos.filter(todo => todo.status === 'deleted').length,
            overdue: allTodos.filter(todo => {
                return new Date(todo.endDate) < new Date() && 
                       !todo.completed && 
                       todo.status === 'active';
            }).length
        };
    }
}
    </script>
    <script>
        // ä¸»åº”ç”¨
const app = {
    todoManager: new TodoManager(),
    appSettings: {},
    currentTodoPath: '/todos',

    async init() {
        console.log('åˆå§‹åŒ–Todoåº”ç”¨...');
        
        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        await FirebaseService.testConnection();
        
        // åŠ è½½åº”ç”¨é…ç½®
        await this.loadAppSettings();
        
        // ç»‘å®šäº‹ä»¶
        this.bindEvents();
        
        // åŠ è½½todos
        await this.loadTodos();
        
        // ç›‘å¬å®æ—¶æ›´æ–°
        this.setupRealtimeListeners();
        
        console.log('Todoåº”ç”¨åˆå§‹åŒ–å®Œæˆ');
    },

    async loadAppSettings() {
        try {
            this.appSettings = await FirebaseService.getAppSettings('/appSetting/todoSetting');
            this.applyAppSettings();
            console.log('åº”ç”¨é…ç½®åŠ è½½å®Œæˆ:', this.appSettings);
        } catch (error) {
            console.error('åŠ è½½åº”ç”¨é…ç½®å¤±è´¥:', error);
            this.appSettings = FirebaseService.getDefaultSettings();
            this.applyAppSettings();
        }
    },

    applyAppSettings() {
        const settings = this.appSettings;
        
        // æ›´æ–°å½“å‰è·¯å¾„
        this.currentTodoPath = settings.appRootPath || '/todos';
        document.getElementById('currentPath').textContent = `è·¯å¾„: ${this.currentTodoPath}`;

        // åŠŸèƒ½å¼€å…³
        if (settings.features) {
            this.toggleFeature('searchInput', settings.features.search);
            this.toggleFeature('tagFilter', settings.features.filtering);
            this.toggleFeature('statusFilter', settings.features.archiving);
        }

        // UIé…ç½®
        if (settings.ui) {
            this.applyUiSettings(settings.ui);
        }
    },

    toggleFeature(elementId, isEnabled) {
        const element = document.getElementById(elementId);
        if (element) {
            element.style.display = isEnabled ? '' : 'none';
        }
    },

    applyUiSettings(uiSettings) {
        // ä¸»é¢˜è®¾ç½®
        if (uiSettings.theme === 'dark' || (uiSettings.theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark');
            document.body.classList.remove('bg-gray-100');
            document.body.classList.add('bg-gray-900');
        } else {
            document.body.classList.remove('dark');
            document.body.classList.remove('bg-gray-900');
            document.body.classList.add('bg-gray-100');
        }

        // æ¯è¡Œå¡ç‰‡æ•°é‡
        if (uiSettings.cardsPerRow) {
            const todoList = document.getElementById('todoList');
            const gridClass = this.getGridClass(uiSettings.cardsPerRow);
            todoList.className = `grid gap-4 ${gridClass}`;
        }
    },

    getGridClass(cardsPerRow) {
        const gridClasses = {
            1: 'grid-cols-1',
            2: 'grid-cols-1 md:grid-cols-2',
            3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',
            4: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4'
        };
        return gridClasses[cardsPerRow] || 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3';
    },

    getTodoRootPath() {
        return this.appSettings.appRootPath || '/todos';
    },

    async loadTodos() {
        try {
            const rootPath = this.getTodoRootPath();
            console.log(`ä»è·¯å¾„åŠ è½½todos: ${rootPath}`);
            
            const todos = await FirebaseService.getTodos(rootPath);
            this.todoManager.renderTodos(todos);
            this.todoManager.updateTagFilter(todos);
        } catch (error) {
            console.error('åŠ è½½todoså¤±è´¥:', error);
            this.showError('åŠ è½½todoså¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
        }
    },

    setupRealtimeListeners() {
        const rootPath = this.getTodoRootPath();
        
        // ç›‘å¬todoså˜åŒ–
        FirebaseService.onTodosChange((todos) => {
            console.log('æ£€æµ‹åˆ°todoså˜åŒ–ï¼Œæ›´æ–°ç•Œé¢');
            this.todoManager.renderTodos(todos);
            this.todoManager.updateTagFilter(todos);
        }, rootPath);

        // ç›‘å¬åº”ç”¨é…ç½®å˜åŒ–
        FirebaseService.onAppSettingsChange((settings) => {
            console.log('æ£€æµ‹åˆ°åº”ç”¨é…ç½®å˜åŒ–ï¼Œæ›´æ–°è®¾ç½®');
            this.appSettings = settings;
            this.applyAppSettings();
            
            // é‡æ–°åŠ è½½todosä»¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è·¯å¾„
            this.loadTodos();
        }, '/appSetting/todoSetting');
    },

    bindEvents() {
        // æœç´¢åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('input', (e) => {
            this.todoManager.currentSearch = e.target.value;
            this.todoManager.renderTodos(this.todoManager.todos);
        });

        // æ ‡ç­¾è¿‡æ»¤
        document.getElementById('tagFilter').addEventListener('change', (e) => {
            this.todoManager.currentFilter = e.target.value;
            this.todoManager.renderTodos(this.todoManager.todos);
        });

        // çŠ¶æ€è¿‡æ»¤
        document.getElementById('statusFilter').addEventListener('change', (e) => {
            this.todoManager.renderTodos(this.todoManager.todos);
        });

        // æ–°å»ºTodoæŒ‰é’®
        document.getElementById('addTodoBtn').addEventListener('click', () => {
            this.showDialog();
        });

        // ç©ºçŠ¶æ€æ–°å»ºæŒ‰é’®
        document.getElementById('emptyAddBtn').addEventListener('click', () => {
            this.showDialog();
        });

        // é…ç½®æŒ‰é’®
        document.getElementById('settingsBtn').addEventListener('click', () => {
            this.showSettingsDialog();
        });

        // Todoå¯¹è¯æ¡†äº‹ä»¶
        document.getElementById('cancelBtn').addEventListener('click', () => {
            this.hideDialog();
        });

        document.getElementById('todoForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.saveTodo();
        });

        document.getElementById('todoDialog').addEventListener('click', (e) => {
            if (e.target.id === 'todoDialog') {
                this.hideDialog();
            }
        });

        // é…ç½®å¯¹è¯æ¡†äº‹ä»¶
        document.getElementById('settingsCancelBtn').addEventListener('click', () => {
            this.hideSettingsDialog();
        });

        document.getElementById('saveSettingsBtn').addEventListener('click', () => {
            this.saveAppSettings();
        });

        document.getElementById('resetSettingsBtn').addEventListener('click', () => {
            this.resetAppSettings();
        });

        document.getElementById('settingsDialog').addEventListener('click', (e) => {
            if (e.target.id === 'settingsDialog') {
                this.hideSettingsDialog();
            }
        });

        // æ—¥æœŸé»˜è®¤å€¼
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('startDate').value = today;
        document.getElementById('endDate').value = today;

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
            if (e.key === 'Escape') {
                this.hideDialog();
                this.hideSettingsDialog();
            }
        });
    },

    showDialog(todo = null) {
        const dialog = document.getElementById('todoDialog');
        const title = document.getElementById('dialogTitle');
        const form = document.getElementById('todoForm');
        
        if (todo) {
            title.textContent = 'ç¼–è¾‘Todo';
            this.populateForm(todo);
        } else {
            title.textContent = 'æ–°å»ºTodo';
            form.reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
        }
        
        dialog.classList.remove('hidden');
        dialog.classList.add('flex');
        document.getElementById('title').focus();
    },

    hideDialog() {
        const dialog = document.getElementById('todoDialog');
        dialog.classList.add('hidden');
        dialog.classList.remove('flex');
    },

    populateForm(todo) {
        document.getElementById('todoId').value = todo.id;
        document.getElementById('title').value = todo.title;
        document.getElementById('tags').value = todo.tags ? todo.tags.join(', ') : '';
        document.getElementById('startDate').value = todo.startDate;
        document.getElementById('endDate').value = todo.endDate;
        document.getElementById('priority').value = todo.priority;
        document.getElementById('assignee').value = todo.assignee;
    },

    async saveTodo() {
        const formData = {
            id: document.getElementById('todoId').value,
            title: document.getElementById('title').value.trim(),
            tags: document.getElementById('tags').value,
            startDate: document.getElementById('startDate').value,
            endDate: document.getElementById('endDate').value,
            priority: document.getElementById('priority').value,
            assignee: document.getElementById('assignee').value.trim()
        };

        // éªŒè¯å¿…å¡«å­—æ®µ
        if (!formData.title || !formData.assignee) {
            this.showError('æ ‡é¢˜å’Œè´Ÿè´£äººä¸ºå¿…å¡«å­—æ®µ');
            return;
        }

        const todo = this.todoManager.createTodo(formData);
        const rootPath = this.getTodoRootPath();
        const success = await FirebaseService.saveTodo(todo.id, todo, rootPath);
        
        if (success) {
            this.hideDialog();
            this.showSuccess('Todoä¿å­˜æˆåŠŸ');
        } else {
            this.showError('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
        }
    },

    showSettingsDialog() {
        const dialog = document.getElementById('settingsDialog');
        this.populateSettingsForm();
        dialog.classList.remove('hidden');
        dialog.classList.add('flex');
    },

    hideSettingsDialog() {
        const dialog = document.getElementById('settingsDialog');
        dialog.classList.add('hidden');
        dialog.classList.remove('flex');
    },

    populateSettingsForm() {
        const settings = this.appSettings;
        
        // è·¯å¾„é…ç½®
        document.getElementById('appRootPath').value = settings.appRootPath || '/todos';
        
        // åŠŸèƒ½å¼€å…³
        document.getElementById('featureSearch').checked = settings.features?.search !== false;
        document.getElementById('featureFiltering').checked = settings.features?.filtering !== false;
        document.getElementById('featureArchiving').checked = settings.features?.archiving !== false;
        document.getElementById('featureDueDateWarning').checked = settings.features?.dueDateWarning !== false;
        
        // UIé…ç½®
        document.getElementById('uiTheme').value = settings.ui?.theme || 'light';
        document.getElementById('uiCardsPerRow').value = settings.ui?.cardsPerRow || 3;
    },

    async saveAppSettings() {
        const newSettings = {
            appRootPath: document.getElementById('appRootPath').value.trim() || '/todos',
            features: {
                search: document.getElementById('featureSearch').checked,
                filtering: document.getElementById('featureFiltering').checked,
                archiving: document.getElementById('featureArchiving').checked,
                dueDateWarning: document.getElementById('featureDueDateWarning').checked
            },
            ui: {
                theme: document.getElementById('uiTheme').value,
                cardsPerRow: parseInt(document.getElementById('uiCardsPerRow').value)
            }
        };

        const success = await FirebaseService.saveAppSettings(newSettings);
        if (success) {
            this.appSettings = newSettings;
            this.applyAppSettings();
            this.hideSettingsDialog();
            this.showSuccess('é…ç½®ä¿å­˜æˆåŠŸ');
        } else {
            this.showError('é…ç½®ä¿å­˜å¤±è´¥');
        }
    },

    async resetAppSettings() {
        if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤é…ç½®å—ï¼Ÿ')) {
            const defaultSettings = FirebaseService.getDefaultSettings();
            const success = await FirebaseService.saveAppSettings(defaultSettings);
            if (success) {
                this.appSettings = defaultSettings;
                this.applyAppSettings();
                this.hideSettingsDialog();
                this.showSuccess('å·²é‡ç½®ä¸ºé»˜è®¤é…ç½®');
            } else {
                this.showError('é‡ç½®é…ç½®å¤±è´¥');
            }
        }
    },

    async editTodo(todoId) {
        const todo = this.todoManager.todos[todoId];
        if (todo) {
            this.showDialog(todo);
        }
    },

    async archiveTodo(todoId) {
        if (confirm('ç¡®å®šè¦å½’æ¡£è¿™ä¸ªTodoå—ï¼Ÿå½’æ¡£åå°†ä»æ´»åŠ¨åˆ—è¡¨ä¸­éšè—ã€‚')) {
            await this.updateTodoStatus(todoId, 'archived');
        }
    },

    async restoreTodo(todoId) {
        await this.updateTodoStatus(todoId, 'active');
    },

    async softDeleteTodo(todoId) {
        const todo = this.todoManager.todos[todoId];
        const message = todo?.status === 'deleted' 
            ? 'ç¡®å®šè¦å½»åº•åˆ é™¤è¿™ä¸ªTodoå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚' 
            : 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªTodoå—ï¼Ÿ';
        
        if (confirm(message)) {
            if (todo?.status === 'deleted') {
                // å½»åº•åˆ é™¤
                const rootPath = this.getTodoRootPath();
                const success = await FirebaseService.deleteTodo(todoId, rootPath);
                if (success) {
                    this.showSuccess('Todoå·²å½»åº•åˆ é™¤');
                } else {
                    this.showError('åˆ é™¤å¤±è´¥');
                }
            } else {
                // è½¯åˆ é™¤
                await this.updateTodoStatus(todoId, 'deleted');
            }
        }
    },

    async updateTodoStatus(todoId, newStatus) {
        const todo = this.todoManager.todos[todoId];
        if (todo) {
            const oldStatus = todo.status;
            todo.status = newStatus;
            todo.updatedAt = new Date().toISOString();
            
            const rootPath = this.getTodoRootPath();
            const success = await FirebaseService.saveTodo(todoId, todo, rootPath);
            if (success) {
                const statusMessages = {
                    'active': 'Todoå·²æ¢å¤',
                    'archived': 'Todoå·²å½’æ¡£',
                    'deleted': 'Todoå·²åˆ é™¤'
                };
                this.showSuccess(statusMessages[newStatus] || 'çŠ¶æ€æ›´æ–°æˆåŠŸ');
            } else {
                this.showError('çŠ¶æ€æ›´æ–°å¤±è´¥');
            }
            return success;
        }
        return false;
    },

    async toggleComplete(todoId) {
        const todo = this.todoManager.todos[todoId];
        if (todo) {
            todo.completed = !todo.completed;
            todo.updatedAt = new Date().toISOString();
            
            const rootPath = this.getTodoRootPath();
            const success = await FirebaseService.saveTodo(todoId, todo, rootPath);
            if (success) {
                const message = todo.completed ? 'Todoå·²å®Œæˆ' : 'Todoæ ‡è®°ä¸ºæœªå®Œæˆ';
                this.showSuccess(message);
            } else {
                this.showError('æ“ä½œå¤±è´¥');
            }
        }
    },

    showSuccess(message) {
        this.showNotification(message, 'green');
    },

    showError(message) {
        this.showNotification(message, 'red');
    },

    showNotification(message, color = 'blue') {
        const colors = {
            green: 'bg-green-500',
            red: 'bg-red-500',
            blue: 'bg-blue-500'
        };

        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 ${colors[color]} text-white px-6 py-3 rounded-lg shadow-lg fade-in z-50`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('opacity-0');
            notification.classList.add('transition-opacity');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }
};

// åˆå§‹åŒ–åº”ç”¨
document.addEventListener('DOMContentLoaded', () => {
    app.init();
});

// å¯¼å‡ºåˆ°å…¨å±€èŒƒå›´
window.app = app;
    </script>
</body>
</html>